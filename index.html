<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Power Distribution Systems Calculator</title>

<!-- External libraries -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

<style>
:root {
  --primary: #2c3e50;
  --accent: #3498db;
  --success: #27ae60;
  --warning: #f39c12;
  --danger: #e74c3c;
  --light: #f7f9fb;
  --muted: #777;
}

* { box-sizing: border-box; }
body {
  margin: 0;
  font-family: "Segoe UI","Helvetica Neue",Helvetica,Arial,sans-serif;
  font-size: 14px;
  line-height: 1.45;
  background: #f2f5f8;
  color: #222;
}

.container { max-width: 1350px; margin: 18px auto; padding: 18px; }

header.app-header {
  background: var(--primary);
  color: #fff;
  border-radius: 8px;
  padding: 14px 18px;
  margin-bottom: 16px;
  box-shadow: 0 6px 18px rgba(44,62,80,0.06);
}
.app-header .row { display: flex; justify-content: space-between; flex-wrap: wrap; gap: 12px; }
.app-title h1 { font-size: 18px; margin: 0; font-weight: 700; }

.tabs { display: flex; border-bottom: 2px solid #e0e6eb; margin-bottom: 10px; }
.tab {
  padding: 10px 16px; cursor: pointer;
  background: #f4f6f8; border: 1px solid #e0e6eb; border-bottom: none;
  border-radius: 6px 6px 0 0; margin-right: 6px;
  font-weight: 600; font-size: 13px; color: #333;
}
.tab.active { background: #fff; color: var(--accent); border-color: #d0dae0; }
.tab-content { display: none; padding: 14px; background: #fff; border: 1px solid #e0e6eb; border-radius: 0 6px 6px 6px; box-shadow: 0 4px 10px rgba(0,0,0,0.02);}
.tab-content.active { display: block; }

.btn { display: inline-block; padding: 8px 12px; border-radius: 6px; border: 0; cursor: pointer; font-weight: 700; font-size: 13px; }
.btn-primary { background: var(--accent); color:#fff; }
.btn-success { background: var(--success); color:#fff; }
.btn-warning { background: var(--warning); color:#fff; }
.btn-danger  { background: var(--danger); color:#fff; }

.input-row { display: grid; grid-template-columns: repeat(3,1fr); gap: 10px; margin-bottom: 12px; }
label { font-size: 13px; margin-bottom: 6px; display: block; font-weight: 600; color: #333; }
input[type="text"], input[type="number"], select {
  width: 100%; padding: 8px 10px; border-radius: 6px;
  border: 1px solid #e0e6eb; font-size: 13px; background: #fff;
}

.panel { background:#fff; border-radius:8px; padding:14px; box-shadow: 0 6px 18px rgba(10,20,30,0.04); margin-top: 20px; }
.section-title { font-weight:700; color:var(--primary); font-size:15px; border-bottom:2px solid #f0f4f7; margin-bottom: 10px; padding-bottom: 6px; }

.table { width:100%; border-collapse:collapse; margin-top:10px; font-size:13px; }
.table th, .table td { padding: 8px; border-bottom:1px solid #eef3f7; vertical-align: middle; }
.table th { background: var(--primary); color:#fff; font-weight:700; }
.text-right { text-align:right; }
.text-center { text-align:center; }
.total-row { background:#f6f9fb; font-weight:700; }

.hidden { display:none; }
.note { font-size:13px; color: var(--muted); margin-top:8px; }
</style>
</head>
<body>
<div class="container">

  <!-- HEADER -->
  <header class="app-header">
    <div class="row">
      <div class="app-title"><h1>Power Distribution Systems Calculator</h1></div>
      <div class="header-controls">
        <button id="saveBtn" class="btn btn-primary">Save Project</button>
        <button id="loadBtn" class="btn btn-warning">Load Project</button>
        <button id="exportPdfBtn" class="btn btn-success">Export PDF</button>
        <button id="exportExcelBtn" class="btn btn-success">Export Excel</button>
        <button id="resetBtn" class="btn btn-danger">Reset</button>
      </div>
    </div>
  </header>

  <!-- TABS -->
  <div class="tabs">
    <div class="tab active" data-tab="general">General Parameters</div>
    <div class="tab" data-tab="distribution">Distribution Systems</div>
    <div class="tab" data-tab="cables">Cables & Wiring</div>
    <div class="tab" data-tab="additional">Additional Costs</div>
    <div class="tab" data-tab="help">Help & Reference</div>
  </div>

  <!-- TAB CONTENT: GENERAL -->
  <div id="general-tab" class="tab-content active">
    <h2 class="section-title">General Parameters</h2>
    <div class="input-row">
      <div><label>Project Name</label><input type="text" id="projectName"></div>
      <div><label>Client Name</label><input type="text" id="clientName"></div>
      <div><label>Location</label><input type="text" id="projectLocation"></div>
    </div>
    <div class="input-row">
      <div><label>Prepared By</label><input type="text" id="preparedBy"></div>
      <div><label>Labor Rate (per hr)</label><input type="number" id="laborRate" value="100"></div>
      <div><label>VAT Rate (%)</label><input type="number" id="taxRate" value="12"></div>
    </div>
    <p class="note">Enter project details and financial parameters here.</p>
    <button id="calculateBtn" class="btn btn-primary">Calculate</button>
  </div>

  <!-- TAB CONTENT: DISTRIBUTION -->
  <div id="distribution-tab" class="tab-content">
    <h2 class="section-title">Distribution Systems</h2>
    <div class="input-row">
      <div><label>MDBs</label><input type="number" id="mdbQty" value="0"></div>
      <div><label>SMDBs</label><input type="number" id="smdbQty" value="0"></div>
      <div><label>Panels</label><input type="number" id="panelQty" value="0"></div>
    </div>
    <div class="input-row">
      <div><label>Breakers</label><input type="number" id="breakerQty" value="0"></div>
    </div>
  </div>

  <!-- TAB CONTENT: CABLES -->
  <div id="cables-tab" class="tab-content">
    <h2 class="section-title">Cables & Wiring</h2>
    <div class="input-row">
      <div><label>Cables (m)</label><input type="number" id="cableLength" value="0"></div>
      <div><label>Cable Trays (m)</label><input type="number" id="trayLength" value="0"></div>
      <div><label>Wiring Devices</label><input type="number" id="wiringDeviceQty" value="0"></div>
    </div>
  </div>

  <!-- TAB CONTENT: ADDITIONAL -->
  <div id="additional-tab" class="tab-content">
    <h2 class="section-title">Additional Costs</h2>
    <div class="input-row">
      <div><label>Equipment Cost</label><input type="number" id="equipmentCost" value="0"></div>
      <div><label>Tools Cost</label><input type="number" id="toolsCost" value="0"></div>
      <div><label>Permits Cost</label><input type="number" id="permitsCost" value="0"></div>
    </div>
  </div>

  <!-- TAB CONTENT: HELP -->
  <div id="help-tab" class="tab-content">
    <h2 class="section-title">Help & Reference</h2>
    <p><b>Guide:</b> Fill inputs → Calculate → Export</p>
    <p><b>References:</b> PEC, IEC Standards</p>
    <p><b>Formulas:</b> Material + Labor + Indirects + Profit + VAT</p>
  </div>

  <!-- RESULTS -->
  <div class="output-section">
    <h2 class="section-title">Estimate Results</h2>
    <div id="resultsPlaceholder"><p>Enter details and click Calculate.</p></div>
    <div id="resultsContent" class="hidden">
      <h3>Project: <span id="resultProjectName"></span></h3>
      <p><strong>Client:</strong> <span id="resultClientName"></span></p>
      <p><strong>Location:</strong> <span id="resultProjectLocation"></span></p>
      <p><strong>Date:</strong> <span id="resultProjectDate"></span></p>
      <p><strong>Prepared By:</strong> <span id="resultPreparedBy"></span></p>
      <p><strong>Standard:</strong> <span id="resultStandard"></span></p>

      <h4>Bill of Quantity</h4>
      <table class="table">
        <thead><tr><th>#</th><th>Item</th><th>Qty</th><th>Unit</th><th>Material</th><th>Labor</th><th>Total</th></tr></thead>
        <tbody id="billOfQuantityTableBody"></tbody>
      </table>

      <h4>Indirect Costs</h4>
      <table class="table"><tbody id="indirectCostsTableBody"></tbody></table>

      <h4>Summary</h4>
      <table class="table"><tbody id="summaryTableBody"></tbody></table>

      <h4>Labor Requirements</h4>
      <table class="table"><tbody id="laborTableBody"></tbody></table>

      <div class="export-options">
        <button id="saveResultsBtn" class="btn btn-success">Save Results (JSON)</button>
      </div>
    </div>
  </div>
</div>

<script>
let projectData = {};

function safeNumber(v,f=0){const n=Number(v);return isNaN(n)?f:n;}
function formatNumber(n,d=2){return n.toLocaleString(undefined,{minimumFractionDigits:d,maximumFractionDigits:d});}
function formatCurrency(n){if(typeof n!=="number"||isNaN(n))return"";return "₱ "+formatNumber(n,2);}
function formatCurrencyForPDF(n){if(typeof n!=="number"||isNaN(n))return"";return "PHP "+formatNumber(n,2);}

function calculateEstimate(){
  const laborRate=safeNumber(document.getElementById("laborRate").value);
  const taxRate=safeNumber(document.getElementById("taxRate").value)/100;
  const equipmentCost=safeNumber(document.getElementById("equipmentCost").value);
  const toolsCost=safeNumber(document.getElementById("toolsCost").value);
  const permitsCost=safeNumber(document.getElementById("permitsCost").value);

  const workItems=[
    {name:"MDBs",qty:safeNumber(mdbQty.value),unit:"pcs",cost:10000,hours:8},
    {name:"SMDBs",qty:safeNumber(smdbQty.value),unit:"pcs",cost:8000,hours:6},
    {name:"Panels",qty:safeNumber(panelQty.value),unit:"pcs",cost:5000,hours:5},
    {name:"Breakers",qty:safeNumber(breakerQty.value),unit:"pcs",cost:2000,hours:2},
    {name:"Cables",qty:safeNumber(cableLength.value),unit:"m",cost:150,hours:0.05},
    {name:"Cable Trays",qty:safeNumber(trayLength.value),unit:"m",cost:200,hours:0.1},
    {name:"Wiring Devices",qty:safeNumber(wiringDeviceQty.value),unit:"pcs",cost:100,hours:0.25}
  ];

  let matTotal=0,labTotal=0,manHours=0;
  workItems.forEach(it=>{
    it.matCost=it.qty*it.cost;
    it.labCost=it.qty*it.hours*laborRate;
    it.total=it.matCost+it.labCost;
    matTotal+=it.matCost;labTotal+=it.labCost;manHours+=it.qty*it.hours;
  });

  const direct=matTotal+labTotal+equipmentCost+toolsCost+permitsCost;
  const profit=direct*0.25;
  const beforeTax=direct+profit;
  const tax=beforeTax*taxRate;
  const grandTotal=beforeTax+tax;

  projectData={projectName:projectName.value,client:clientName.value,location:projectLocation.value,preparedBy:preparedBy.value,date:new Date().toLocaleDateString(),
    workItems,matTotal,labTotal,direct,profit,tax,grandTotal,manHours};

  displayResults();
}

function displayResults(){
  resultProjectName.textContent=projectData.projectName;
  resultClientName.textContent=projectData.client;
  resultProjectLocation.textContent=projectData.location;
  resultProjectDate.textContent=projectData.date;
  resultPreparedBy.textContent=projectData.preparedBy;
  resultStandard.textContent="PEC";

  const tbody=billOfQuantityTableBody;tbody.innerHTML="";
  let no=1;
  projectData.workItems.forEach(it=>{
    if(it.qty>0){
      tbody.insertAdjacentHTML("beforeend",
      `<tr><td>${no++}</td><td>${it.name}</td><td>${it.qty}</td><td>${it.unit}</td><td class="text-right">${formatCurrency(it.matCost)}</td><td class="text-right">${formatCurrency(it.labCost)}</td><td class="text-right">${formatCurrency(it.total)}</td></tr>`);
    }
  });

  indirectCostsTableBody.innerHTML=`<tr><td>1</td><td>Profit</td><td>1</td><td>lot</td><td class="text-right">${formatCurrency(projectData.profit)}</td><td>-</td><td class="text-right">${formatCurrency(projectData.profit)}</td></tr>
    <tr><td>2</td><td>VAT</td><td>1</td><td>lot</td><td class="text-right">${formatCurrency(projectData.tax)}</td><td>-</td><td class="text-right">${formatCurrency(projectData.tax)}</td></tr>`;

  summaryTableBody.innerHTML=`<tr><td>Materials</td><td class="text-right">${formatCurrency(projectData.matTotal)}</td><td>-</td><td class="text-right">${formatCurrency(projectData.matTotal)}</td></tr>
    <tr><td>Labor</td><td>-</td><td class="text-right">${formatCurrency(projectData.labTotal)}</td><td class="text-right">${formatCurrency(projectData.labTotal)}</td></tr>
    <tr><td>Direct Costs</td><td colspan="2"></td><td class="text-right">${formatCurrency(projectData.direct)}</td></tr>
    <tr><td>Profit</td><td colspan="2"></td><td class="text-right">${formatCurrency(projectData.profit)}</td></tr>
    <tr><td>VAT</td><td colspan="2"></td><td class="text-right">${formatCurrency(projectData.tax)}</td></tr>
    <tr class="total-row"><td><b>GRAND TOTAL</b></td><td colspan="2"></td><td class="text-right"><b>${formatCurrency(projectData.grandTotal)}</b></td></tr>`;

  laborTableBody.innerHTML=`<tr><td>Man-Hours</td><td class="text-center">-</td><td class="text-center">-</td><td class="text-center">${formatNumber(projectData.manHours,2)}</td></tr>`;

  resultsPlaceholder.classList.add("hidden");
  resultsContent.classList.remove("hidden");
}

document.getElementById("calculateBtn").addEventListener("click",calculateEstimate);
document.getElementById("exportPdfBtn").addEventListener("click",()=>{const {jsPDF}=window.jspdf;const doc=new jsPDF();doc.text("Project: "+projectData.projectName,20,20);doc.text("Grand Total: "+formatCurrencyForPDF(projectData.grandTotal),20,40);doc.save("report.pdf");});
document.getElementById("exportExcelBtn").addEventListener("click",()=>{const wb=XLSX.utils.book_new();const data=[["Project",projectData.projectName],["Client",projectData.client],["Grand Total",projectData.grandTotal]];const ws=XLSX.utils.aoa_to_sheet(data);XLSX.utils.book_append_sheet(wb,ws,"Summary");XLSX.writeFile(wb,"report.xlsx");});
document.getElementById("saveResultsBtn").addEventListener("click",()=>{const dataStr=JSON.stringify(projectData,null,2);const blob=new Blob([dataStr],{type:"application/json"});const link=document.createElement("a");link.href=URL.createObjectURL(blob);link.download="results.json";link.click();});
</script>
</body>
</html>
